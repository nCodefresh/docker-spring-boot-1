version: '1.0'
steps:

#  pre_deploy:
#    image: garland/aws-cli-docker
#    commands:
#      - aws --version # your command to stop task
#    environment:
#      - AWS_ACCESS_KEY_ID=${{AWS_ACCESS_KEY_ID}}
#      - AWS_SECRET_ACCESS_KEY=${{AWS_SECRET_ACCESS_KEY}}
#      - AWS_DEFAULT_REGION=${{AWS_DEFAULT_REGION}}
#  slack_notify:
#    image: tutum/curl
#    commands:
#      - >-
#        curl -X POST --data-urlencode 'payload={"text":"New RF-images pushed with tag: ${{CF_BRANCH_TAG_NORMALIZED}}-${{CF_SHORT_REVISION}}-${{CF_BUILD_TIMESTAMP}}"}' ${{SLACK_WEB_URL}}
#


  build_step:
    type: build
    title: Building Docker Image
    image_name: ncodefresh/docker-spring-boot
    working_directory: ${{main_clone}}
    dockerfile: Dockerfile
    when:
      condition:
        all:
          skip_tests_in_commit_message: |
            includes(lower('${{CF_COMMIT_MESSAGE}}'), 'cf-skip-tests') == false
          skip_tests_variable: lower('${{CF_SKIP_TESTS}}') != 'true'
#
#  DeployDev:
#    title: Deploy DEV
#    image: klickinc/aws-cli-docker:latest
#    working_directory: ${{main_clone}}
#    commands:
#      - echo $CF_REVISION

#  DeployDev:
#    title: Deploy DEV
#    image: klickinc/aws-cli-docker:latest
#    working_directory: ${{main_clone}}
#    commands:
#      - echo test
#    when:
#      branch:
#        only:
#          - master

#  unit_test:
#    image: node:latest
#    fail_fast: false
#    commands:
#      - echo test1
#      - touch file.txt
#
#  unit_test2:
#    image: node:latest
#    fail_fast: false
#    commands:
#      - echo result $TEST
#
#  push_to_dockerhub:
#    type: push
#    title: Step Title
#    description: Free text description
#    candidate: ${{build_step}}
#    tag: latest
#    registry: 'dockerhub-release'
#    when:
#      condition:
#        all:
#          noSkipCiInCommitMessage: '${{TEST}} == true'
#
#  unit_tests:
#    image: php:7.0
#    commands:
#      - phpunit Test.php
#
#  freestyle_step:
#    image: node:latest
#    commands:
#      - echo TEST:${{TEST}}
#      - echo TEST1:${{TEST1}}
#      - echo TEST2:${{TEST2}}

#  push_to_step:
#    title: Push to Dockerhub
#    type: push
#    candidate: ${{build_step}}
#    registry: gcr.io
#    credentials:
#      username: ${{USERNAME}}
#      password: ${{TOKEN}}

#  step_name:
#    type: push
#    title: Step Title
#    description: Free text description
#    candidate: ${{build_step_name}}
#    tag: latest
#    registry: dtr.host.com
#    credentials:
#      username: subject
#      password: credentials
#    fail_fast: false
#    when:
#      branch:
#        only:
#          - master
#  unit-tests:
#    image: ${{build-step-name}}
#    commands:
#      - echo TEST:$TEST
#      - echo TEST:${{TEST}}
#      - echo TEST1:${{TEST1}}
#
#  composition_step:
#    type: composition
#    title: Step Title
#    description: Free text description
#    working_directory: ${{main_clone}}
#    composition:
#      version: '2'
#      services:
#        postgres:
#          restart: always
#          image: 'postgres:latest'
#          ports:
#            - 5432
#          environment:
#            - POSTGRES_DB=videoplatform
#    composition_candidates:
#      test_service:
#        image: node:latest
#        command: echo TEST:${{TEST}}
#    composition_variables:
#      - key=value
