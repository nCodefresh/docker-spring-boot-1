version: '1.0'
steps:
  build_image:
    type: build
    title: Building Docker Image
    image_name: ncodefresh/maven-build
    dockerfile: Dockerfile
#
#  check_build_step:
#    image: node:latest
#    working_directory: ${{main_clone}}
#    commands:
#      - pwd
#      - ls -l
#
#  some_travis_step:
#    type: travis
#    services:
#      redis:
#        image: redis
#      mongo:
#        image: mongo
#      mysql:
#        image: mysql
#        ports: [ 3316, 3317 ]
#        environment:
#          - MYSQL_USERNAME: user
#          - MYSQL_PASSWORD: pass
#    test:
#      image: my_user/some_image
#      command:
#        - last_bash_command

#  push_to_ecr:
#    provider: ecr
#    type: push
#    candidate: '${{build_image}}'
#    region: '${{CODEFRESH_REGION}}'
#    accessKeyId: '${{CODEFRESH_ACCESS_KEY_ID}}'
#    secretAccessKey: '${{CODEFRESH_SECRET_ACCESS_KEY}}'
#    tag: '${{CF_SHORT_REVISION}}'

#  push_to_dockerhub:
#    type: push
#    title: Step Title
#    description: Free text description
#    candidate: ${{build_step_name}}
#    tag: latest
#    credentials:
#      username: ${{DOCKER_USERNAME}}
#      password: ${{DOCKER_PASSWORD}}
#    when:
#      branch:
#        only:
#          - master
#
#  unit_tests:
#    image: php:7.0
#    commands:
#      - phpunit Test.php
#
#  freestyle_step:
#    image: node:latest
#    commands:
#      - echo TEST:${{TEST}}
#      - echo TEST1:${{TEST1}}
#      - echo TEST2:${{TEST2}}

#  push_to_step:
#    title: Push to Quay.io
#    type: push
#    candidate: ${{build_step}}
#    registry: quay.io
#    credentials:
#      username: ${{USERNAME}}
#      password: ${{TOKEN}}
#  step_name:
#    type: push
#    title: Step Title
#    description: Free text description
#    candidate: ${{build_step_name}}
#    tag: latest
#    registry: dtr.host.com
#    credentials:
#      username: subject
#      password: credentials
#    fail_fast: false
#    when:
#      branch:
#        only:
#          - master
#  unit-tests:
#    image: ${{build-step-name}}
#    commands:
#      - echo TEST:$TEST
#      - echo TEST:${{TEST}}
#      - echo TEST1:${{TEST1}}
#
  composition_step:
    type: composition
    title: Step Title
    description: Free text description
    working_directory: ${{main_clone}}
    composition:
      version: '2'
      services:
        postgres:
          restart: always
          image: 'postgres:latest'
          ports:
            - 5432
          environment:
            - POSTGRES_DB=videoplatform
    composition_candidates:
      test_service:
        image: node:latest
        command: echo TEST:${{TEST}}
    composition_variables:
      - key=value
